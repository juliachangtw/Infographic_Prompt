<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI è³‡è¨Šåœ–è¡¨è¬èƒ½æç¤ºè©ç”Ÿæˆå™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Noto Sans TC", sans-serif;
        background-color: #f0f4f8;
      }
      .gradient-text {
        background: linear-gradient(135deg, #2563eb, #7c3aed);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      .card {
        background: white;
        border-radius: 16px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        transition: all 0.3s ease;
      }
      .card:hover {
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }
      select,
      input,
      textarea {
        transition: all 0.2s;
      }
      select:focus,
      input:focus,
      textarea:focus {
        ring: 2px;
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
      }
      .file-upload-wrapper {
        position: relative;
        overflow: hidden;
        display: inline-block;
      }
      .file-upload-wrapper input[type="file"] {
        font-size: 100px;
        position: absolute;
        left: 0;
        top: 0;
        opacity: 0;
        cursor: pointer;
      }
      .color-swatch {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: inline-block;
        border: 2px solid white;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .style-tag {
        background-color: #e0e7ff;
        color: #3730a3;
        padding: 2px 8px;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 500;
        display: inline-block;
        margin-right: 4px;
        margin-bottom: 4px;
      }
    </style>
  </head>
  <body class="min-h-screen p-4 md:p-8">
    <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8">
      <!-- Left Column: Controls -->
      <div class="space-y-6">
        <div class="text-center lg:text-left mb-8">
          <h1 class="text-3xl md:text-4xl font-bold mb-2">
            ğŸ“Š è³‡è¨Šåœ–è¡¨ <span class="gradient-text">è¬èƒ½æç¤ºè©ç”Ÿæˆå™¨</span>
          </h1>
          <p class="text-gray-600">
            åŸºæ–¼ 100 ç¨®å°ˆæ¥­æ’ç‰ˆæ¶æ§‹ï¼Œç‚º Midjourney / DALL-E 3 ç”Ÿæˆç²¾æº–æŒ‡ä»¤ã€‚
          </p>
        </div>

        <!-- Input Form -->
        <div class="card p-6 space-y-5">
          <!-- NEW: Image Style Analysis Section -->
          <div class="bg-indigo-50 p-4 rounded-xl border border-indigo-100">
            <label
              class="block text-sm font-bold text-indigo-900 mb-2 flex items-center gap-2"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
                />
              </svg>
              0. è¦–è¦ºåƒè€ƒåœ–ç‰‡ (Optional)
            </label>
            <div class="flex items-start gap-4">
              <div
                class="flex-shrink-0 w-24 h-24 bg-gray-200 rounded-lg overflow-hidden flex items-center justify-center border border-gray-300 relative group"
                id="imagePreviewBox"
              >
                <span class="text-xs text-gray-400 text-center px-1"
                  >ç„¡åœ–ç‰‡</span
                >
                <img
                  id="imagePreview"
                  class="w-full h-full object-cover hidden"
                />
              </div>
              <div class="flex-grow">
                <div class="file-upload-wrapper w-full mb-2">
                  <button
                    class="w-full text-sm bg-white hover:bg-gray-50 text-indigo-600 font-medium px-4 py-2 rounded border border-indigo-200 shadow-sm transition-colors text-left flex justify-between items-center"
                  >
                    <span>ä¸Šå‚³åœ–ç‰‡åˆ†æé¢¨æ ¼èˆ‡è‰²èª¿...</span>
                    <span
                      class="text-xs bg-indigo-100 px-2 py-0.5 rounded text-indigo-700"
                      >Auto Analysis</span
                    >
                  </button>
                  <input type="file" id="imageInput" accept="image/*" />
                </div>

                <!-- Analysis Results -->
                <div id="analysisResults" class="hidden space-y-2">
                  <!-- Colors -->
                  <div class="flex items-center gap-2">
                    <span class="text-xs font-bold text-gray-500 w-10"
                      >Palette:</span
                    >
                    <div class="flex gap-1" id="swatchContainer"></div>
                  </div>
                  <!-- Style Tags -->
                  <div class="flex items-start gap-2">
                    <span class="text-xs font-bold text-gray-500 w-10 mt-1"
                      >Style:</span
                    >
                    <div id="styleTagsContainer" class="flex flex-wrap"></div>
                  </div>
                </div>

                <p class="text-xs text-gray-500 mt-1" id="imageTip">
                  ä¸Šå‚³å¾Œå°‡è‡ªå‹•åˆ†æè‰²å½©ã€äº®åº¦èˆ‡å°æ¯”ï¼Œæ¨å°è¦–è¦ºé—œéµå­—ã€‚
                </p>
              </div>
            </div>
          </div>

          <!-- Subject -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >1. ä¸»é¡Œ (Subject)</label
            >
            <input
              type="text"
              id="subject"
              placeholder="ä¾‹å¦‚ï¼šç”Ÿæˆå¼ AI çš„ç™¼å±•æ­·å²ã€å’–å•¡è±†çš„è£½ä½œéç¨‹"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-blue-500 text-gray-900 placeholder-gray-400"
            />
          </div>

          <!-- Category & Layout -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >2. æ’ç‰ˆé¡åˆ¥ (Category)</label
              >
              <select
                id="categorySelect"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg text-gray-900 bg-white"
              >
                <!-- JS will populate this -->
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >3. åœ–è¡¨é¡å‹ (Layout)</label
              >
              <select
                id="layoutSelect"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg text-gray-900 bg-white"
              >
                <!-- JS will populate this -->
              </select>
            </div>
          </div>

          <!-- Visual Style -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >4. è¦–è¦ºé¢¨æ ¼ (Visual Style)</label
            >
            <select
              id="styleSelect"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg text-gray-900 bg-white"
            >
              <!-- JS will populate this -->
            </select>
            <div class="mt-2 flex items-center gap-2">
              <input
                type="checkbox"
                id="useImageStyle"
                class="rounded text-blue-600 focus:ring-blue-500"
                disabled
              />
              <label
                for="useImageStyle"
                class="text-sm text-gray-600 cursor-pointer opacity-50"
                id="useImageStyleLabel"
                >æ‡‰ç”¨åˆ†æå‡ºçš„ã€Œè¦–è¦ºå±¬æ€§ã€åˆ°æç¤ºè©ä¸­</label
              >
            </div>
          </div>

          <!-- Data Source / Context Input -->
          <div>
            <div class="flex justify-between items-center mb-1">
              <label class="block text-sm font-medium text-gray-700"
                >5. åƒè€ƒè³‡æ–™/æ•¸æ“š (Context & Data)</label
              >
              <div class="file-upload-wrapper">
                <button
                  class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1 rounded border border-gray-300 flex items-center gap-1 transition-colors"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-3 w-3"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                    />
                  </svg>
                  è®€å–æ–‡å­—æª”
                </button>
                <input
                  type="file"
                  id="fileInput"
                  accept=".txt,.csv,.md,.json,.js,.html"
                />
              </div>
            </div>
            <textarea
              id="dataInput"
              rows="3"
              placeholder="åœ¨æ­¤è¼¸å…¥åœ–è¡¨éœ€è¦çš„æ•¸æ“šã€æ–‡å­—å…§å®¹ï¼Œæˆ–ä¸Šå‚³æ–‡ä»¶è‡ªå‹•å¡«å…¥..."
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-blue-500 text-gray-900 placeholder-gray-400 text-sm font-mono"
            ></textarea>
            <p
              class="text-xs text-gray-500 mt-1 text-right"
              id="fileStatus"
            ></p>
          </div>

          <!-- Details (Ratio, Color) -->
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >æ¯”ä¾‹ (Aspect Ratio)</label
              >
              <select
                id="ratio"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg text-gray-900 bg-white"
              >
                <option value="16:9">16:9 (æ©«å‘å¯¬è¢å¹•)</option>
                <option value="3:2">3:2 (æ¨™æº–ç…§ç‰‡)</option>
                <option value="1:1">1:1 (æ­£æ–¹å½¢)</option>
                <option value="9:16">9:16 (æ‰‹æ©Ÿç›´å¼)</option>
                <option value="A4 Portrait (1:1.41)">A4 ç›´å¼ (Portrait)</option>
                <option value="A4 Landscape (1.41:1)">
                  A4 æ©«å¼ (Landscape)
                </option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >è‰²èª¿ (Color Palette)</label
              >
              <select
                id="color"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg text-gray-900 bg-white"
              >
                <option value="default">è«‹é¸æ“‡æˆ–ä¸Šå‚³åœ–ç‰‡è‡ªå‹•åˆ†æ</option>
                <option value="Vibrant Gradients">
                  é®®è±”æ¼¸å±¤ (Vibrant Gradients)
                </option>
                <option value="Blue and White">
                  å°ˆæ¥­è—ç™½ (Blue and White)
                </option>
                <option value="Pastel Tones">æŸ”å’Œç²‰å½© (Pastel Tones)</option>
                <option value="Dark Mode Neon">
                  æ·±è‰²éœ“è™¹ (Dark Mode Neon)
                </option>
                <option value="Earth Tones">å¤§åœ°è‰²ç³» (Earth Tones)</option>
                <option value="Monochrome">å–®è‰²æ¥µç°¡ (Monochrome)</option>
                <option value="Corporate Professional">
                  ä¼æ¥­å°ˆæ¥­ (Corporate Professional)
                </option>
              </select>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="flex gap-3 pt-2">
            <button
              id="randomBtn"
              class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors flex items-center justify-center gap-2"
            >
              éš¨æ©Ÿéˆæ„Ÿ
            </button>
            <button
              id="generateBtn"
              class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-bold shadow-lg shadow-blue-500/30 transition-all transform active:scale-95 flex items-center justify-center gap-2"
            >
              ç”Ÿæˆæç¤ºè©
            </button>
          </div>
        </div>
      </div>

      <!-- Right Column: Output -->
      <div class="flex flex-col h-full">
        <div
          class="card p-1 flex-grow flex flex-col relative overflow-hidden h-full"
        >
          <div
            class="bg-gray-800 text-white px-4 py-2 rounded-t-lg flex justify-between items-center"
          >
            <span class="font-mono text-sm font-bold">Prompt Output</span>
            <span class="text-xs text-gray-400">Markdown Format</span>
          </div>
          <textarea
            id="output"
            readonly
            class="flex-grow w-full bg-gray-900 text-gray-100 font-mono text-sm p-4 border-none resize-none focus:ring-0 leading-relaxed"
            spellcheck="false"
          >
ç­‰å¾…ç”Ÿæˆ...</textarea
          >

          <div class="absolute bottom-4 right-4">
            <button
              id="copyBtn"
              class="px-6 py-2 bg-white text-gray-900 rounded-full font-bold shadow-lg hover:bg-gray-100 transition-all flex items-center gap-2 transform active:scale-95"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"
                />
              </svg>
              è¤‡è£½æç¤ºè©
            </button>
          </div>
          <div
            id="copyToast"
            class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black bg-opacity-80 text-white px-4 py-2 rounded-lg opacity-0 transition-opacity pointer-events-none"
          >
            å·²è¤‡è£½ï¼
          </div>
        </div>

        <div
          class="mt-4 p-4 bg-yellow-50 rounded-lg border border-yellow-100 text-xs text-yellow-800"
        >
          <strong>ğŸ“ åœ–ç‰‡åˆ†æèªªæ˜ï¼š</strong><br />
          1.
          <strong>é¢¨æ ¼åµæ¸¬ï¼š</strong>
          ç³»çµ±æœƒä¾æ“šåœ–ç‰‡çš„äº®åº¦ã€é£½å’Œåº¦èˆ‡å°æ¯”åº¦ï¼Œè‡ªå‹•æ¨ç®—å¦‚ã€ŒHigh Contrast
          (é«˜å°æ¯”)ã€ã€ã€ŒMinimalist (æ¥µç°¡)ã€ç­‰å±¬æ€§ã€‚<br />
          2.
          <strong>ä½¿ç”¨æ–¹å¼ï¼š</strong>
          å‹¾é¸ã€Œæ‡‰ç”¨è¦–è¦ºå±¬æ€§ã€å¾Œï¼Œé€™äº›é—œéµå­—æœƒè‡ªå‹•åŠ å…¥ Prompt
          ä¸­ï¼Œè®“ç”Ÿæˆçš„é¢¨æ ¼æ›´ä¸€è‡´ã€‚
        </div>
      </div>
    </div>

    <!-- Hidden Canvas for Processing -->
    <canvas id="canvas" class="hidden"></canvas>

    <script>
      // --- DATA SOURCE ---
      const styles = [
        { name: "æ‰å¹³å‘é‡ (Flat Vector Art)", val: "Flat Vector Art" },
        { name: "ç­‰è· 3D (Isometric 3D)", val: "Isometric 3D" },
        { name: "ä¼æ¥­å­Ÿè²æ–¯ (Corporate Memphis)", val: "Corporate Memphis" },
        { name: "æ‰‹ç¹ªè‰åœ– (Hand-Drawn Sketch)", val: "Hand-Drawn Sketch" },
        { name: "å·¥ç¨‹è—åœ– (Blueprint Schematic)", val: "Blueprint Schematic" },
        { name: "éœ“è™¹è³½åšé¾å…‹ (Neon Cyberpunk)", val: "Neon Cyberpunk" },
        { name: "å‰ªç´™é¢¨æ ¼ (Paper Cutout)", val: "Paper Cutout" },
        { name: "æ¯›ç»ç’ƒæ“¬æ…‹ (Glassmorphism)", val: "Glassmorphism" },
        { name: "ä½å¤šé‚Šå½¢ (Low Poly)", val: "Low Poly" },
        { name: "é»‘æ¿ç²‰ç­† (Chalkboard Style)", val: "Chalkboard Style" },
        { name: "å¾©å¤åœ°åœ– (Vintage Map)", val: "Vintage Map Style" },
        { name: "æ¥µç°¡ç·šæ¢ (Minimalist Line Art)", val: "Minimalist Line Art" },
      ];

      const layoutData = {
        "ä¸€ã€ç·šæ€§èˆ‡æ™‚åºé¡ (Linear)": [
          {
            name: "æ°´å¹³æ™‚é–“è»¸ (Horizontal Timeline)",
            val: "Horizontal Timeline",
          },
          { name: "å‚ç›´æ™‚é–“è»¸ (Vertical Timeline)", val: "Vertical Timeline" },
          {
            name: "èœ¿èœ’é“è·¯åœ– (Winding Road Roadmap)",
            val: "Winding Road Roadmap",
          },
          { name: "Så‹/è›‡å½¢æ’ç‰ˆ (Snake Layout)", val: "Snake Layout" },
          { name: "èºæ—‹æ™‚é–“è»¸ (Spiral Timeline)", val: "Spiral Timeline" },
          { name: "ç”˜ç‰¹åœ–é¢¨æ ¼ (Gantt Chart Style)", val: "Gantt Chart Style" },
          { name: "éšæ¢¯åœ– (Step Ladder)", val: "Step Ladder" },
          { name: "è¼¸é€å¸¶ç¤ºæ„åœ– (Conveyor Belt)", val: "Conveyor Belt" },
          {
            name: "åœ°éµè·¯ç·šåœ–é¢¨æ ¼ (Subway Map Style)",
            val: "Subway Map Style",
          },
          { name: "éª¨ç‰Œæ•ˆæ‡‰åœ– (Domino Effect)", val: "Domino Effect" },
        ],
        "äºŒã€æ¯”è¼ƒèˆ‡å°ç…§é¡ (Comparison)": [
          { name: "æ–‡æ°åœ– (Venn Diagram)", val: "Venn Diagram" },
          {
            name: "åˆ†å‰²ç•«é¢æ¯”è¼ƒ (Split Screen Comparison)",
            val: "Split Screen Comparison",
          },
          { name: "Tå­—è¡¨ (T-Chart)", val: "T-Chart" },
          { name: "è´è¶åœ– (Butterfly Chart)", val: "Butterfly Chart" },
          { name: "é›·é”åœ– (Radar Chart)", val: "Radar Chart" },
          { name: "å¤©å¹³åœ– (Balance Scale)", val: "Balance Scale" },
          { name: "ä½¿ç”¨å‰/å¾Œ (Before and After)", val: "Before and After" },
          { name: "å››è±¡é™çŸ©é™£ (Quadrant Matrix)", val: "Quadrant Matrix" },
          {
            name: "å¹³è¡Œåº§æ¨™åœ– (Parallel Coordinates)",
            val: "Parallel Coordinates",
          },
          { name: "å•éˆ´åœ– (Dumbbell Plot)", val: "Dumbbell Plot" },
        ],
        "ä¸‰ã€å±¤ç´šèˆ‡çµæ§‹é¡ (Hierarchy)": [
          {
            name: "çµ„ç¹”çµæ§‹åœ– (Organizational Chart)",
            val: "Organizational Chart",
          },
          { name: "å¿ƒæ™ºåœ– (Mind Map)", val: "Mind Map" },
          { name: "é‡‘å­—å¡”åœ– (Pyramid Diagram)", val: "Pyramid Diagram" },
          { name: "å€’é‡‘å­—å¡” (Inverted Pyramid)", val: "Inverted Pyramid" },
          { name: "æ¨¹ç‹€åœ– (Tree Diagram)", val: "Tree Diagram" },
          { name: "æ—­æ—¥åœ– (Sunburst Chart)", val: "Sunburst Chart" },
          { name: "çŸ©å½¢æ¨¹ç‹€åœ– (Treemap)", val: "Treemap" },
          { name: "åœ“å½¢å¡«å……åœ– (Circle Packing)", val: "Circle Packing" },
          { name: "å·¢ç‹€åœ– (Nested Boxes)", val: "Nested Boxes" },
          { name: "å†°æŸ±åœ– (Icicle Chart)", val: "Icicle Chart" },
        ],
        "å››ã€æµç¨‹èˆ‡ç³»çµ±é¡ (Process)": [
          { name: "æµç¨‹åœ– (Flowchart)", val: "Flowchart" },
          { name: "æ¡‘åŸºåœ– (Sankey Diagram)", val: "Sankey Diagram" },
          { name: "æ±ºç­–æ¨¹ (Decision Tree)", val: "Decision Tree" },
          { name: "å¾ªç’°åœ– (Cycle Diagram)", val: "Cycle Diagram" },
          { name: "æ¼æ–—åœ– (Funnel Chart)", val: "Funnel Chart" },
          { name: "é½’è¼ªç³»çµ±åœ– (Gear System)", val: "Gear System" },
          {
            name: "é›»è·¯åœ–é¢¨æ ¼ (Circuit Diagram Style)",
            val: "Circuit Diagram Style",
          },
          { name: "æ³³é“åœ– (Swimlane Diagram)", val: "Swimlane Diagram" },
          { name: "å›é¥‹è¿´åœˆ (Feedback Loop)", val: "Feedback Loop" },
          { name: "æ¼”ç®—æ³•æ¶æ§‹åœ– (Algorithm Schema)", val: "Algorithm Schema" },
        ],
        "äº”ã€æ•¸æ“šè¦–è¦ºåŒ–é¡ (Data Viz)": [
          { name: "ç”œç”œåœˆåœ– (Donut Chart)", val: "Donut Chart" },
          {
            name: "çˆ†ç‚¸åœ“é¤…åœ– (Exploded Pie Chart)",
            val: "Exploded Pie Chart",
          },
          { name: "å †ç–Šæ¢å½¢åœ– (Stacked Bar Chart)", val: "Stacked Bar Chart" },
          { name: "é¢ç©åœ– (Area Chart)", val: "Area Chart" },
          { name: "æ•£ä½ˆåœ– (Scatter Plot)", val: "Scatter Plot" },
          { name: "æ°£æ³¡åœ– (Bubble Chart)", val: "Bubble Chart" },
          { name: "ç†±åŠ›åœ– (Heatmap)", val: "Heatmap" },
          { name: "ç€‘å¸ƒåœ– (Waterfall Chart)", val: "Waterfall Chart" },
          { name: "å„€è¡¨æ¿åœ– (Gauge Chart)", val: "Gauge Chart" },
          { name: "è±¡å½¢çµ±è¨ˆåœ– (Pictogram Chart)", val: "Pictogram Chart" },
        ],
        "å…­ã€åœ°ç†èˆ‡ç©ºé–“é¡ (Geography)": [
          { name: "ç­‰å€¼è‰²å¡Šåœ°åœ– (Choropleth Map)", val: "Choropleth Map" },
          {
            name: "é»åˆ†ä½ˆåœ°åœ– (Dot Distribution Map)",
            val: "Dot Distribution Map",
          },
          { name: "èˆªç·š/é€£æ¥åœ°åœ– (Connection Map)", val: "Connection Map" },
          {
            name: "ç­‰è·åŸå¸‚åœ°åœ– (Isometric City Map)",
            val: "Isometric City Map",
          },
          { name: "åœ°éµè·¯ç·šé¢¨æ ¼ (Metro Map Style)", val: "Metro Map Style" },
          { name: "å¹³é¢é…ç½®åœ– (Floor Plan)", val: "Floor Plan" },
          { name: "ç­‰é«˜ç·šåœ– (Topographic Map)", val: "Topographic Map" },
          { name: "å…¨çƒç¶²çµ¡åœ– (Global Network)", val: "Global Network" },
          { name: "æµå‘åœ°åœ– (Flow Map)", val: "Flow Map" },
          {
            name: "å¥‡å¹»åœ°åœ–é¢¨æ ¼ (Fantasy Map Style)",
            val: "Fantasy Map Style",
          },
        ],
        "ä¸ƒã€éš±å–»èˆ‡æ¦‚å¿µé¡ (Metaphor)": [
          { name: "å†°å±±æ¨¡å‹ (Iceberg Model)", val: "Iceberg Model" },
          { name: "è§£å‰–åœ– (Anatomy Cutaway)", val: "Anatomy Cutaway" },
          { name: "æ©‹æ¨‘éš±å–» (Bridge Metaphor)", val: "Bridge Metaphor" },
          { name: "æ‹¼åœ–éš±å–» (Puzzle Jigsaw)", val: "Puzzle Jigsaw" },
          {
            name: "å¤ªé™½ç³»æ¨¡å‹ (Solar System Model)",
            val: "Solar System Model",
          },
          { name: "åŸå­çµæ§‹ (Atom Structure)", val: "Atom Structure" },
          { name: "ä¸‰æ˜æ²»åˆ†å±¤ (Sandwich Layering)", val: "Sandwich Layering" },
          { name: "è¿·å®®åœ– (Maze / Labyrinth)", val: "Maze / Labyrinth" },
          { name: "ç‘å£«åˆ€éš±å–» (Swiss Army Knife)", val: "Swiss Army Knife" },
          {
            name: "è—åœ–é¢¨æ ¼ (Construction Blueprint)",
            val: "Construction Blueprint",
          },
        ],
        "å…«ã€åˆ—è¡¨èˆ‡è³‡è¨Šæ¸…å–®é¡ (List)": [
          { name: "è¦–è¦ºåŒ–æ¸…å–® (Infographic List)", val: "Infographic List" },
          {
            name: "é€±æœŸè¡¨é¢¨æ ¼ (Periodic Table Style)",
            val: "Periodic Table Style",
          },
          { name: "é€ŸæŸ¥è¡¨ (Cheat Sheet)", val: "Cheat Sheet" },
          { name: "æª¢æŸ¥è¡¨æ’ç‰ˆ (Checklist Layout)", val: "Checklist Layout" },
          { name: "æ§‹é€ æ¨™ç¤º (Anatomy Labeling)", val: "Anatomy Labeling" },
          { name: "å¡ç‰‡ç¶²æ ¼ (Card Grid)", val: "Card Grid" },
          { name: "åšèˆ‡ä¸åš (Do's and Don'ts)", val: "Do's and Don'ts" },
          { name: "è¡“èªè¡¨æ’ç‰ˆ (Glossary Layout)", val: "Glossary Layout" },
          { name: "é£Ÿè­œé¢¨æ ¼ (Recipe Style)", val: "Recipe Style" },
          { name: "åŠŸèƒ½ç¶²æ ¼ (Feature Grid)", val: "Feature Grid" },
        ],
        "ä¹ã€å„€è¡¨æ¿èˆ‡ç¶œåˆé¡ (Dashboard)": [
          { name: "é—œéµç¸¾æ•ˆå„€è¡¨æ¿ (KPI Dashboard)", val: "KPI Dashboard" },
          { name: "æŠ¬é ­é¡¯ç¤ºå™¨ (HUD Style)", val: "HUD (Heads-Up Display)" },
          { name: "é•·æ¢æµ·å ± (Infographic Poster)", val: "Infographic Poster" },
          { name: "å ±ç´™æ’ç‰ˆ (Broadsheet Layout)", val: "Broadsheet Layout" },
          { name: "äººç‰©èªŒå¡ç‰‡ (User Persona Card)", val: "User Persona Card" },
          {
            name: "é¡§å®¢æ—…ç¨‹åœ°åœ– (Customer Journey Map)",
            val: "Customer Journey Map",
          },
          { name: "ç”Ÿæ…‹ç³»åœ°åœ– (Ecosystem Map)", val: "Ecosystem Map" },
          {
            name: "å•†æ¥­æ¨¡å¼ç•«å¸ƒ (Business Model Canvas)",
            val: "Business Model Canvas",
          },
          { name: "SWOT åˆ†æåœ– (SWOT Analysis)", val: "SWOT Analysis" },
          {
            name: "æŠ€è¡“å †ç–Šåœ– (Tech Stack Layering)",
            val: "Tech Stack Layering",
          },
        ],
      };

      // --- DOM ELEMENTS ---
      const categorySelect = document.getElementById("categorySelect");
      const layoutSelect = document.getElementById("layoutSelect");
      const styleSelect = document.getElementById("styleSelect");
      const subjectInput = document.getElementById("subject");
      const dataInput = document.getElementById("dataInput");
      const fileInput = document.getElementById("fileInput");
      const fileStatus = document.getElementById("fileStatus");
      const ratioSelect = document.getElementById("ratio");
      const colorSelect = document.getElementById("color");
      const generateBtn = document.getElementById("generateBtn");
      const randomBtn = document.getElementById("randomBtn");
      const outputArea = document.getElementById("output");
      const copyBtn = document.getElementById("copyBtn");
      const copyToast = document.getElementById("copyToast");

      // New Image Elements
      const imageInput = document.getElementById("imageInput");
      const imagePreview = document.getElementById("imagePreview");
      const imagePreviewBox = document.getElementById("imagePreviewBox");
      const analysisResults = document.getElementById("analysisResults");
      const swatchContainer = document.getElementById("swatchContainer");
      const styleTagsContainer = document.getElementById("styleTagsContainer");
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d", { willReadFrequently: true });
      const useImageStyle = document.getElementById("useImageStyle");
      const useImageStyleLabel = document.getElementById("useImageStyleLabel");

      let extractedColors = [];
      let detectedStyleTags = [];

      // --- INITIALIZATION ---
      function init() {
        // Populate Categories
        for (const category in layoutData) {
          const option = document.createElement("option");
          option.value = category;
          option.textContent = category;
          categorySelect.appendChild(option);
        }

        // Populate Styles
        styles.forEach((style) => {
          const option = document.createElement("option");
          option.value = style.val;
          option.textContent = style.name;
          styleSelect.appendChild(option);
        });

        updateLayouts();
        generatePrompt();
      }

      function updateLayouts() {
        const selectedCategory = categorySelect.value;
        const layouts = layoutData[selectedCategory];
        layoutSelect.innerHTML = "";
        layouts.forEach((layout) => {
          const option = document.createElement("option");
          option.value = layout.val;
          option.textContent = layout.name;
          layoutSelect.appendChild(option);
        });
      }

      // --- IMAGE HANDLING LOGIC ---
      imageInput.addEventListener("change", function (e) {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (event) {
          const img = new Image();
          img.onload = function () {
            // Show preview
            imagePreview.src = img.src;
            imagePreview.classList.remove("hidden");
            imagePreviewBox.querySelector("span").classList.add("hidden");

            // Process analysis
            analyzeImage(img);

            // Enable Style Checkbox
            useImageStyle.disabled = false;
            useImageStyleLabel.classList.remove("opacity-50");
            useImageStyleLabel.classList.add("text-indigo-700", "font-medium");
            useImageStyle.checked = true; // Auto check

            generatePrompt();
          };
          img.src = event.target.result;
        };
        reader.readAsDataURL(file);
      });

      function analyzeImage(img) {
        // Resize image to canvas for performance
        const SIZE = 100;
        canvas.width = SIZE;
        canvas.height = SIZE;
        ctx.drawImage(img, 0, 0, SIZE, SIZE);

        const imageData = ctx.getImageData(0, 0, SIZE, SIZE).data;
        const colorMap = {};
        let totalBrightness = 0;
        let totalSaturation = 0;
        let redSum = 0;
        let blueSum = 0;
        let validPixels = 0;

        // Stats for variance/contrast
        let brightnesses = [];

        for (let i = 0; i < imageData.length; i += 4) {
          if (imageData[i + 3] < 128) continue; // skip transparent

          const r = imageData[i];
          const g = imageData[i + 1];
          const b = imageData[i + 2];

          // 1. Color Quantization
          const rQ = Math.round(r / 50) * 50;
          const gQ = Math.round(g / 50) * 50;
          const bQ = Math.round(b / 50) * 50;
          const key = `${rQ},${gQ},${bQ}`;
          colorMap[key] = (colorMap[key] || 0) + 1;

          // 2. Brightness (Luminance)
          const brightness = 0.299 * r + 0.587 * g + 0.114 * b;
          totalBrightness += brightness;
          brightnesses.push(brightness);

          // 3. Saturation (HSV model approx)
          const max = Math.max(r, g, b);
          const min = Math.min(r, g, b);
          const delta = max - min;
          const saturation = max === 0 ? 0 : delta / max; // 0-1
          totalSaturation += saturation;

          // 4. Color Temp (Basic Red vs Blue)
          redSum += r;
          blueSum += b;

          validPixels++;
        }

        if (validPixels === 0) return;

        // -- Extract Colors --
        const sortedColors = Object.entries(colorMap)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 5)
          .map((entry) => {
            const [r, g, b] = entry[0].split(",").map(Number);
            return rgbToHex(r, g, b);
          });
        extractedColors = sortedColors;

        // -- Analyze Style Attributes --
        const avgBrightness = totalBrightness / validPixels; // 0-255
        const avgSaturation = (totalSaturation / validPixels) * 100; // 0-100

        // Calculate Contrast (Standard Deviation of Brightness)
        const mean = avgBrightness;
        const variance =
          brightnesses.reduce((acc, val) => acc + Math.pow(val - mean, 2), 0) /
          validPixels;
        const stdDev = Math.sqrt(variance);

        const tempDiff = (redSum - blueSum) / validPixels; // +Warm, -Cool

        // -- Map to Tags --
        let tags = [];

        // Brightness Tags
        if (avgBrightness < 60) tags.push("Dark Mode", "Moody", "Night Theme");
        else if (avgBrightness > 190)
          tags.push("High Key", "Clean Background", "Minimalist");

        // Saturation Tags
        if (avgSaturation > 60)
          tags.push("Vibrant", "High Saturation", "Pop Style");
        else if (avgSaturation < 15)
          tags.push("Monochrome", "Muted Tones", "Professional");
        else if (avgSaturation < 30) tags.push("Low Saturation", "Subtle");

        // Contrast Tags
        if (stdDev > 60) tags.push("High Contrast", "Dramatic Lighting");
        else if (stdDev < 25) tags.push("Flat Lighting", "Soft Shadows");

        // Temperature Tags
        if (tempDiff > 30) tags.push("Warm Tone");
        else if (tempDiff < -30) tags.push("Cool Tone");

        detectedStyleTags = tags;

        // -- UI Update --
        swatchContainer.innerHTML = "";
        sortedColors.forEach((hex) => {
          const span = document.createElement("span");
          span.className = "color-swatch";
          span.style.backgroundColor = hex;
          span.title = hex;
          swatchContainer.appendChild(span);
        });

        styleTagsContainer.innerHTML = "";
        tags.forEach((tag) => {
          const span = document.createElement("span");
          span.className = "style-tag";
          span.textContent = tag;
          styleTagsContainer.appendChild(span);
        });

        analysisResults.classList.remove("hidden");

        // Auto-select extracted color option
        let customOption = colorSelect.querySelector(
          'option[value="custom_extracted"]'
        );
        if (!customOption) {
          customOption = document.createElement("option");
          customOption.value = "custom_extracted";
          colorSelect.appendChild(customOption);
        }
        customOption.textContent = `âœ… åœ–ç‰‡åˆ†æè‰²èª¿`;
        colorSelect.value = "custom_extracted";
      }

      function rgbToHex(r, g, b) {
        return (
          "#" +
          ((1 << 24) + (r << 16) + (g << 8) + b)
            .toString(16)
            .slice(1)
            .toUpperCase()
        );
      }

      // --- FILE CONTENT HANDLING ---
      fileInput.addEventListener("change", function (event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function (e) {
          const content = e.target.result;
          const existing = dataInput.value;
          const separator = existing ? "\n\n" : "";
          dataInput.value =
            existing + separator + `[File: ${file.name}]\n` + content;
          fileStatus.textContent = `å·²è®€å–: ${file.name}`;
          fileStatus.className = "text-xs text-green-600 mt-1 text-right";
          generatePrompt();
        };
        reader.readAsText(file);
      });

      // --- MAIN GENERATOR ---
      function generatePrompt() {
        const subject = subjectInput.value.trim() || "[Insert Subject Here]";
        const layout = layoutSelect.value;
        const style = styleSelect.value;
        const ratio = ratioSelect.value;
        let color = colorSelect.value;
        const dataContext = dataInput.value.trim();
        const useRefImage = useImageStyle.checked && !useImageStyle.disabled;

        // Handle Custom Color Logic
        let colorString = color;
        if (color === "custom_extracted" && extractedColors.length > 0) {
          colorString = `Custom Palette extracted from reference: ${extractedColors.join(
            ", "
          )}`;
        } else if (color === "default" || color === "custom_extracted") {
          colorString = "Vibrant and Professional"; // Fallback
        }

        let prompt = `**Prompt:**
Create a professional infographic.

**Subject:** ${subject}
**Layout/Chart Type:** ${layout}
**Visual Style:** ${style}`;

        if (useRefImage) {
          // Add Detected Style Tags to prompt
          if (detectedStyleTags.length > 0) {
            prompt += `, ${detectedStyleTags.join(", ")}`;
          }
          prompt += `\n**Style Reference:** Please analyze the attached image and replicate its visual style, composition, lighting, and mood.`;
        }

        prompt += `
**Aspect Ratio:** ${ratio}
**Language:** Traditional Chinese labels (ç¹é«”ä¸­æ–‡)
**Color Palette:** ${colorString}`;

        if (dataContext) {
          prompt += `\n**Content & Data Source:**\n${dataContext}`;
        }

        prompt += `\n**Details:** High resolution, 4k, clean background, clearly defined sections, minimalistic icons, visual hierarchy, aesthetically pleasing composition.`;

        outputArea.value = prompt;
      }

      function randomize() {
        const subjects = [
          "Evolution of AI",
          "Coffee Brewing Methods",
          "Sustainable Energy Types",
          "History of the Internet",
          "Healthy Eating Pyramid",
          "Remote Work Benefits",
          "Cybersecurity Basics",
          "Blockchain Explained",
        ];
        subjectInput.value =
          subjects[Math.floor(Math.random() * subjects.length)];

        const categories = Object.keys(layoutData);
        const randomCat =
          categories[Math.floor(Math.random() * categories.length)];
        categorySelect.value = randomCat;
        updateLayouts();

        const layouts = layoutData[randomCat];
        layoutSelect.value =
          layouts[Math.floor(Math.random() * layouts.length)].val;

        styleSelect.value =
          styles[Math.floor(Math.random() * styles.length)].val;

        const ratios = ratioSelect.options;
        ratioSelect.selectedIndex = Math.floor(Math.random() * ratios.length);

        // Don't randomize color if we have extracted colors
        if (colorSelect.value !== "custom_extracted") {
          const colors = colorSelect.options;
          let randIndex = Math.floor(Math.random() * (colors.length - 2)) + 1;
          colorSelect.selectedIndex = randIndex;
        }

        dataInput.value = "";
        fileStatus.textContent = "";

        generatePrompt();
      }

      function copyToClipboard() {
        outputArea.select();
        document.execCommand("copy");
        copyToast.style.opacity = "1";
        setTimeout(() => {
          copyToast.style.opacity = "0";
        }, 2000);
      }

      // --- EVENT LISTENERS ---
      categorySelect.addEventListener("change", updateLayouts);
      generateBtn.addEventListener("click", generatePrompt);
      randomBtn.addEventListener("click", randomize);
      copyBtn.addEventListener("click", copyToClipboard);

      [
        layoutSelect,
        styleSelect,
        ratioSelect,
        colorSelect,
        useImageStyle,
      ].forEach((el) => {
        el.addEventListener("change", generatePrompt);
      });

      init();
    </script>
  </body>
</html>
